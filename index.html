<script>
  const WAKEUP_URL = 'https://maker.ifttt.com/trigger/WAKEUP/with/key/hnISI0zYilbKIora8FUlDhrW3VN2JZM4ibrsaCTYrhe';
  const PING_URL = 'https://maker.ifttt.com/trigger/shut down/with/key/hnISI0zYilbKIora8FUlDhrW3VN2JZM4ibrsaCTYrhe';
  const cooldownKey = 'sharedCooldown';
  const cooldownSeconds = 60;

  const wakeupBtn = document.getElementById('wakeupBtn');
  const pingBtn = document.getElementById('pingBtn');

  async function getCurrentTime() {
    try {
      const res = await fetch('https://worldtimeapi.org/api/ip');
      const data = await res.json();
      return new Date(data.utc_datetime).getTime();
    } catch {
      return Date.now();
    }
  }

  function triggerWebhook(url) {
    fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ triggered: true })
    }).catch(console.error);
  }

  async function startCooldown() {
    const now = await getCurrentTime();
    localStorage.setItem(cooldownKey, now);

    wakeupBtn.disabled = true;
    wakeupBtn.classList.remove('ready');
    wakeupBtn.classList.add('cooldown');

    let secondsLeft = cooldownSeconds;
    wakeupBtn.textContent = `WAKE AARON UP (${secondsLeft})`;

    const interval = setInterval(() => {
      secondsLeft--;
      wakeupBtn.textContent = `WAKE AARON UP (${secondsLeft})`;

      if (secondsLeft <= 0) {
        clearInterval(interval);
        wakeupBtn.disabled = false;
        wakeupBtn.classList.remove('cooldown');
        wakeupBtn.classList.add('ready');
        wakeupBtn.textContent = 'WAKE AARON UP';
      }
    }, 1000);
  }

  async function tryTrigger(type) {
    if (type === 'wakeup') {
      const now = await getCurrentTime();
      const last = parseInt(localStorage.getItem(cooldownKey) || 0);
      if (now - last < cooldownSeconds * 1000) return;

      triggerWebhook(WAKEUP_URL);
      startCooldown();
    } else if (type === 'ping') {
      triggerWebhook(PING_URL); // No cooldown for this
    }
  }

  function doSomethingFun() {
    const box = document.getElementById('funBox');
    box.style.display = 'block';
    box.innerText = 'ðŸŽ‰HEYYYY YASMIN LOLðŸŽ‰';
  }

  wakeupBtn.onclick = () => tryTrigger('wakeup');
  pingBtn.onclick = () => tryTrigger('ping');

  async function restoreCooldown() {
    const now = await getCurrentTime();
    const last = parseInt(localStorage.getItem(cooldownKey) || 0);
    const elapsed = now - last;

    if (elapsed < cooldownSeconds * 1000) {
      let remaining = Math.ceil((cooldownSeconds * 1000 - elapsed) / 1000);

      wakeupBtn.disabled = true;
      wakeupBtn.classList.remove('ready');
      wakeupBtn.classList.add('cooldown');
      wakeupBtn.textContent = `WAKE AARON UP (${remaining})`;

      const interval = setInterval(() => {
        remaining--;
        wakeupBtn.textContent = `WAKE AARON UP (${remaining})`;

        if (remaining <= 0) {
          clearInterval(interval);
          wakeupBtn.disabled = false;
          wakeupBtn.classList.remove('cooldown');
          wakeupBtn.classList.add('ready');
          wakeupBtn.textContent = 'WAKE AARON UP';
        }
      }, 1000);
    }
  }

  restoreCooldown();
</script>
